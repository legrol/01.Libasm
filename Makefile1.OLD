# ══ Names & Directories ═════════════════════════════════════════════════════
NAME 		= libasm.a
OBJ_DIR		= obj
SRC_DIR		= src
INC_DIR		= includes
LIBASM_DIR	= libasm
LIBASM_BONUS_DIR = libasm_bonus

# ══ Colors ══════════════════════════════════════════════════════════════════
YELLOW 		= \033[0;93m
GREEN 		= \033[0;92m
RED 		= \033[0;91m
CYAN 		= \033[0;96m
DEF_COLOR 	= \033[0;39m

# ══ Compiler & Flags ════════════════════════════════════════════════════════
CC 			= gcc
NASM		= nasm
RM			= rm -f
MKD			= mkdir -p
CFLAGS		= -Wall -Werror -Wextra
IFLAGS		= -I$(INC_DIR)
NASMFLAGS	= -f elf64

# ══ Sources ═════════════════════════════════════════════════════════════════
SRC 		= $(SRC_DIR)/main.c

ASM_SRC 	= $(LIBASM_DIR)/ft_strlen.s \
			  $(LIBASM_DIR)/ft_strcpy.s \
			  $(LIBASM_DIR)/ft_strcmp.s \
			  $(LIBASM_DIR)/ft_write.s \
			  $(LIBASM_DIR)/ft_read.s \
			  $(LIBASM_DIR)/ft_strdup.s

ASM_BONUS_SRC = $(LIBASM_BONUS_DIR)/ft_atoi_base.s \
				$(LIBASM_BONUS_DIR)/ft_list_push_front.s \
				$(LIBASM_BONUS_DIR)/ft_list_size.s \
				$(LIBASM_BONUS_DIR)/ft_list_sort.s \
				$(LIBASM_BONUS_DIR)/ft_list_remove_if.s

# ══ Objects ═════════════════════════════════════════════════════════════════
OBJ_SRC		= $(SRC:$(SRC_DIR)/%.c=$(OBJ_DIR)/%.o)
OBJ_ASM		= $(ASM_SRC:$(LIBASM_DIR)/%.s=$(OBJ_DIR)/%.o)
OBJ_BONUS	= $(ASM_BONUS_SRC:$(LIBASM_BONUS_DIR)/%.s=$(OBJ_DIR)/%.o)

# ══ Rules ═══════════════════════════════════════════════════════════════════
all: $(NAME)

$(NAME): $(OBJ_ASM) $(OBJ_BONUS)
	@echo "$(YELLOW)Creating static library $(NAME)...$(DEF_COLOR)"
	@ar rcs $(NAME) $(OBJ_ASM) $(OBJ_BONUS)
	@echo "$(GREEN)✓ $(NAME) created successfully!$(DEF_COLOR)"

.PHONY: test
test: $(NAME) $(OBJ_SRC)
	@echo "$(YELLOW)Linking test binary...$(DEF_COLOR)"
	@$(CC) $(CFLAGS) $(IFLAGS) -o test $(OBJ_SRC) $(NAME)
	@echo "$(GREEN)✓ test binary created!$(DEF_COLOR)"


$(OBJ_DIR)/%.o: $(SRC_DIR)/%.c | $(OBJ_DIR)
	@echo "$(CYAN)Compiling $<...$(DEF_COLOR)"
	@$(CC) $(CFLAGS) $(IFLAGS) -c $< -o $@

$(OBJ_DIR)/%.o: $(LIBASM_DIR)/%.s | $(OBJ_DIR)
	@echo "$(CYAN)Assembling $<...$(DEF_COLOR)"
	@$(NASM) $(NASMFLAGS) $< -o $@

$(OBJ_DIR)/%.o: $(LIBASM_BONUS_DIR)/%.s | $(OBJ_DIR)
	@echo "$(CYAN)Assembling $<...$(DEF_COLOR)"
	@$(NASM) $(NASMFLAGS) $< -o $@

$(OBJ_DIR):
	@$(MKD) $(OBJ_DIR)

clean:
	@echo "$(YELLOW)Removing object files...$(DEF_COLOR)"
	@$(RM) -r $(OBJ_DIR)
	@echo "$(RED)Object files removed$(DEF_COLOR)"

fclean: clean
	@echo "$(YELLOW)Removing binaries...$(DEF_COLOR)"
	@$(RM) $(NAME)
	@echo "$(RED)Binaries removed$(DEF_COLOR)"

re: fclean all

.PHONY: all clean fclean re
